<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Detective Comprehensive Quiz | AWS Security Specialty (SCS-C03)</title>
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #141b2d;
            --bg-tertiary: #1a2236;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --accent-primary: #8b5cf6;
            --accent-secondary: #a78bfa;
            --success: #22c55e;
            --error: #ef4444;
            --warning: #eab308;
            --info: #3b82f6;
            --border: #2d3a52;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.6; min-height: 100vh; }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        header { text-align: center; margin-bottom: 2rem; padding: 2rem; background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%); border-radius: 16px; border: 1px solid var(--border); }
        .badge { display: inline-block; background: var(--accent-primary); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; margin-bottom: 1rem; text-transform: uppercase; }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .subtitle { color: var(--text-secondary); font-size: 1rem; }
        .stats-bar { display: flex; justify-content: center; gap: 2rem; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border); }
        .stat { text-align: center; }
        .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--accent-primary); }
        .stat-label { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; }
        .mode-selector { display: flex; gap: 1rem; justify-content: center; margin-bottom: 2rem; }
        .mode-btn { padding: 0.75rem 2rem; border: 2px solid var(--border); background: var(--bg-secondary); color: var(--text-primary); border-radius: 8px; cursor: pointer; font-size: 1rem; transition: all 0.3s ease; }
        .mode-btn:hover { border-color: var(--accent-primary); background: var(--bg-tertiary); }
        .mode-btn.active { border-color: var(--accent-primary); background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(167, 139, 250, 0.1)); }
        .progress-container { background: var(--bg-secondary); border-radius: 12px; padding: 1rem 1.5rem; margin-bottom: 1.5rem; border: 1px solid var(--border); }
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .progress-text { font-size: 0.875rem; color: var(--text-secondary); }
        .timer { font-size: 1.25rem; font-weight: 600; color: var(--accent-primary); font-family: 'Consolas', monospace; }
        .timer.warning { color: var(--warning); animation: pulse 1s infinite; }
        .timer.danger { color: var(--error); animation: pulse 0.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .progress-bar { height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); border-radius: 4px; transition: width 0.3s ease; }
        .question-card { background: var(--bg-secondary); border-radius: 16px; padding: 2rem; margin-bottom: 1.5rem; border: 1px solid var(--border); }
        .question-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
        .question-number { background: var(--bg-tertiary); color: var(--accent-primary); padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.875rem; font-weight: 600; }
        .question-domain { font-size: 0.75rem; color: var(--text-secondary); background: var(--bg-tertiary); padding: 0.25rem 0.5rem; border-radius: 4px; }
        .question-text { font-size: 1.125rem; margin-bottom: 1.5rem; line-height: 1.7; }
        .options { display: flex; flex-direction: column; gap: 0.75rem; }
        .option { display: flex; align-items: flex-start; gap: 1rem; padding: 1rem; background: var(--bg-tertiary); border: 2px solid var(--border); border-radius: 10px; cursor: pointer; transition: all 0.2s ease; }
        .option:hover:not(.disabled) { border-color: var(--accent-primary); background: rgba(139, 92, 246, 0.1); }
        .option.selected { border-color: var(--accent-primary); border-width: 3px; background: rgba(139, 92, 246, 0.2); box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.25), inset 0 0 12px rgba(139, 92, 246, 0.1); }
        .option.correct { border-color: var(--success); background: rgba(34, 197, 94, 0.15); }
        .option.incorrect { border-color: var(--error); background: rgba(239, 68, 68, 0.15); }
        .option.disabled { cursor: default; }
        .option-marker { width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.875rem; flex-shrink: 0; transition: all 0.2s ease; }
        .option.selected .option-marker { border-color: var(--accent-primary); background: var(--accent-primary); color: white; }
        .option.correct .option-marker { border-color: var(--success); background: var(--success); color: white; }
        .option.incorrect .option-marker { border-color: var(--error); background: var(--error); color: white; }
        .option-text { flex: 1; padding-top: 2px; }
        .explanation { margin-top: 1.5rem; padding: 1.5rem; background: var(--bg-tertiary); border-radius: 10px; border-left: 4px solid var(--info); display: none; }
        .explanation.show { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .explanation-title { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--info); }
        .answer-header { font-weight: 600; color: var(--success); margin-bottom: 0.5rem; }
        .explanation-text { color: var(--text-secondary); margin-bottom: 1rem; }
        .doc-link { display: inline-flex; align-items: center; gap: 0.5rem; color: var(--accent-primary); text-decoration: none; font-size: 0.875rem; padding: 0.5rem 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 6px; transition: background 0.2s ease; }
        .doc-link:hover { background: rgba(139, 92, 246, 0.2); }
        .btn-container { display: flex; justify-content: space-between; gap: 1rem; margin-top: 1rem; }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .btn-primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4); }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-secondary:hover { border-color: var(--accent-primary); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .results-card { background: var(--bg-secondary); border-radius: 16px; padding: 2rem; text-align: center; border: 1px solid var(--border); display: none; }
        .results-card.show { display: block; animation: fadeIn 0.5s ease; }
        .results-score { font-size: 4rem; font-weight: 700; margin: 1rem 0; }
        .results-score.pass { color: var(--success); }
        .results-score.fail { color: var(--error); }
        .results-status { font-size: 1.5rem; margin-bottom: 1rem; }
        .results-status.pass { color: var(--success); }
        .results-status.fail { color: var(--error); }
        .results-details { color: var(--text-secondary); margin-bottom: 2rem; }
        .results-breakdown { display: flex; justify-content: center; gap: 3rem; margin-bottom: 2rem; padding: 1.5rem; background: var(--bg-tertiary); border-radius: 10px; }
        .breakdown-item { text-align: center; }
        .breakdown-value { font-size: 2rem; font-weight: 700; }
        .breakdown-value.correct { color: var(--success); }
        .breakdown-value.incorrect { color: var(--error); }
        .breakdown-label { font-size: 0.875rem; color: var(--text-secondary); }
        .hidden { display: none !important; }
        .shuffle-notice { text-align: center; padding: 0.75rem; background: rgba(139, 92, 246, 0.1); border-radius: 8px; margin-bottom: 1.5rem; color: var(--accent-secondary); font-size: 0.875rem; }
        @media (max-width: 640px) { .container { padding: 1rem; } h1 { font-size: 1.5rem; } .stats-bar { gap: 1rem; } .mode-selector { flex-direction: column; } .btn-container { flex-direction: column; } .results-breakdown { flex-direction: column; gap: 1.5rem; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <span class="badge">Domain 1: Detection</span>
            <h1>üîç Amazon Detective</h1>
            <p class="subtitle">Comprehensive Quiz for AWS Security Specialty (SCS-C03)</p>
            <div class="stats-bar">
                <div class="stat"><div class="stat-value">20</div><div class="stat-label">Questions</div></div>
                <div class="stat"><div class="stat-value">80%</div><div class="stat-label">Pass Score</div></div>
                <div class="stat"><div class="stat-value">50:00</div><div class="stat-label">Exam Time</div></div>
            </div>
        </header>
        <div class="mode-selector" id="modeSelector">
            <button class="mode-btn" onclick="startQuiz('learn')">üìö Learn Mode</button>
            <button class="mode-btn" onclick="startQuiz('exam')">‚è±Ô∏è Exam Mode</button>
        </div>
        <div id="quizContent" class="hidden">
            <div class="progress-container">
                <div class="progress-header">
                    <span class="progress-text">Question <span id="currentQ">1</span> of <span id="totalQ">20</span></span>
                    <span class="timer" id="timer">50:00</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
            </div>
            <div class="shuffle-notice" id="shuffleNotice">üîÄ Questions and options have been randomized</div>
            <div id="questionsContainer"></div>
            <div class="btn-container">
                <button class="btn btn-secondary" id="prevBtn" onclick="navigate(-1)" disabled>‚Üê Previous</button>
                <button class="btn btn-secondary" id="shuffleBtn" onclick="shuffleQuiz()">üîÄ Shuffle</button>
                <button class="btn btn-primary" id="nextBtn" onclick="navigate(1)">Next ‚Üí</button>
            </div>
        </div>
        <div class="results-card" id="resultsCard">
            <h2>Quiz Complete!</h2>
            <div class="results-score" id="scorePercent">0%</div>
            <div class="results-status" id="resultStatus">-</div>
            <p class="results-details" id="resultDetails"></p>
            <div class="results-breakdown">
                <div class="breakdown-item"><div class="breakdown-value correct" id="correctCount">0</div><div class="breakdown-label">Correct</div></div>
                <div class="breakdown-item"><div class="breakdown-value incorrect" id="incorrectCount">0</div><div class="breakdown-label">Incorrect</div></div>
            </div>
            <button class="btn btn-primary" onclick="restartQuiz()">üîÑ Restart Quiz</button>
        </div>
    </div>
    <script>
        const questions = [
            {
                id: 1,
                question: "What is the primary purpose of Amazon Detective?",
                options: [
                    "To continuously monitor AWS resources and automatically generate security findings",
                    "To analyze, investigate, and identify the root cause of security findings",
                    "To aggregate and centralize security findings from multiple AWS services",
                    "To execute automated remediation playbooks for detected security events"
                ],
                correct: 1,
                explanation: "Amazon Detective helps you analyze, investigate, and quickly identify the root cause of security findings or suspicious activities. It automatically collects log data from your AWS resources and uses machine learning, statistical analysis, and graph theory to generate visualizations for efficient security investigations.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/what-is-detective.html"
            },
            {
                id: 2,
                question: "What is a 'behavior graph' in Amazon Detective?",
                options: [
                    "A visualization showing network traffic patterns across VPC endpoints",
                    "A linked dataset from AWS resources that Detective uses for analysis",
                    "A time-series diagram displaying user behavior and API activity",
                    "A workflow diagram for security incident response procedures"
                ],
                correct: 1,
                explanation: "A behavior graph is a linked set of extracted and analyzed data from AWS resources. Detective populates the behavior graph using source data from enabled data sources and uses it to analyze user activity and correlate security findings. Each administrator account has one behavior graph per Region.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/behavior-graph-data-about.html"
            },
            {
                id: 3,
                question: "How long can Amazon Detective retain historical event data for investigation?",
                options: [
                    "30 days",
                    "90 days",
                    "Up to 1 year",
                    "Up to 3 years"
                ],
                correct: 2,
                explanation: "With Amazon Detective, you can access up to a year (12 months) of historical event data. This data is available through visualizations that show changes in the type and volume of activity over a selected time window, helping you identify patterns and root causes.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/what-is-detective.html"
            },
            {
                id: 4,
                question: "Which technologies does Amazon Detective use to analyze security data?",
                options: [
                    "Only machine learning",
                    "Machine learning, statistical analysis, and graph theory",
                    "Only statistical analysis and rule-based detection",
                    "Signature-based detection and heuristics"
                ],
                correct: 1,
                explanation: "Amazon Detective uses machine learning, statistical analysis, and graph theory to generate visualizations that help you conduct faster and more efficient security investigations. These technologies work together to identify patterns and correlate security events.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/what-is-detective.html"
            },
            {
                id: 5,
                question: "What are 'finding groups' in Amazon Detective?",
                options: [
                    "Organizational units in the behavior graph that separate findings by AWS account",
                    "Collections of related findings that may represent a multi-stage security incident",
                    "Filters that categorize GuardDuty findings by severity and type for prioritization",
                    "Saved search queries that group findings matching specific investigation criteria"
                ],
                correct: 1,
                explanation: "Detective finding groups let you examine multiple activities as they relate to a potential security event. If a threat actor attempts to compromise your AWS environment, they typically perform a sequence of actions that generate multiple security findings. Finding groups help you analyze these related activities together.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/groups-about.html"
            },
            {
                id: 6,
                question: "What is 'Detective Investigation' used for?",
                options: [
                    "Generating automated remediation actions for findings based on severity",
                    "Investigating IAM users and roles using indicators of compromise (IOC)",
                    "Creating visual timelines of API calls made during investigation periods",
                    "Correlating VPC Flow Logs with CloudTrail for comprehensive analysis"
                ],
                correct: 1,
                explanation: "Detective Investigation allows you to investigate IAM users and IAM roles using indicators of compromise (IOC). It uses machine learning and threat intelligence to surface the most critical, suspicious issues, helping you determine if a resource is involved in a security incident.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/investigations-about.html"
            },
            {
                id: 7,
                question: "Which AWS service's findings does Amazon Detective primarily link changes to?",
                options: [
                    "AWS Config",
                    "Amazon Inspector",
                    "Amazon GuardDuty",
                    "AWS Security Hub"
                ],
                correct: 2,
                explanation: "Detective links changes in activity to Amazon GuardDuty findings. When you enable Detective, it automatically starts ingesting GuardDuty findings and correlating them with other data sources to help you investigate security issues more effectively.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/what-is-detective.html"
            },
            {
                id: 8,
                question: "Which data sources does Amazon Detective integrate with from Amazon Security Lake?",
                options: [
                    "Only VPC Flow Logs for network traffic analysis",
                    "CloudTrail management events, VPC Flow Logs, and EKS Audit Logs",
                    "Only CloudTrail data events for resource access tracking",
                    "S3 access logs, Lambda invocation logs, and RDS audit logs"
                ],
                correct: 1,
                explanation: "Detective integrates with Amazon Security Lake to collect logs from: AWS CloudTrail management events (version 1.0+), Amazon VPC Flow Logs (version 1.0+), and Amazon EKS Audit Logs (version 2.0). This integration allows you to query raw logs directly in Detective.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/securitylake-integration.html"
            },
            {
                id: 9,
                question: "In Amazon Detective, who can create a behavior graph?",
                options: [
                    "Any IAM user with read permissions",
                    "Only the AWS account root user",
                    "The administrator account that owns the graph",
                    "Any member account in the organization"
                ],
                correct: 2,
                explanation: "Only an administrator account can create and own a behavior graph. The administrator account invites member accounts to contribute their data to the behavior graph. Each administrator account can have only one behavior graph per Region.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/accounts.html"
            },
            {
                id: 10,
                question: "What happens to existing data when a member account is removed from a Detective behavior graph?",
                options: [
                    "All data is immediately deleted",
                    "Data is exported to S3 before deletion",
                    "Existing data remains in the graph",
                    "Data is moved to a quarantine zone"
                ],
                correct: 2,
                explanation: "When an administrator removes a member account from a behavior graph, the existing data from that account remains in the graph. However, Detective stops ingesting new data from the removed account. The historical data continues to be available for investigation.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/accounts-invited-remove.html"
            },
            {
                id: 11,
                question: "Which of the following is an indicator of compromise (IOC) that Detective Investigation can identify?",
                options: [
                    "Outdated software versions",
                    "Impossible travel (accessing from geographically distant locations)",
                    "Missing encryption on S3 buckets",
                    "Unpatched EC2 instances"
                ],
                correct: 1,
                explanation: "Detective Investigation can identify indicators of compromise like impossible travel, which occurs when a user appears to access AWS from geographically distant locations in an impossibly short time. Other IOCs include flagged IP addresses and unusual API patterns.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/investigations-about.html"
            },
            {
                id: 12,
                question: "How does Amazon Detective help investigate VPC network activity?",
                options: [
                    "By automatically blocking suspicious network traffic in real-time",
                    "By analyzing VPC flow volume and network interactions of instances",
                    "By modifying security group rules to prevent future attacks",
                    "By encrypting network traffic between VPC endpoints automatically"
                ],
                correct: 1,
                explanation: "Detective automatically collects VPC flow logs, aggregates them by EC2 instance, and presents visual summaries and analytics about network flows. You can examine the activity details of VPC network flows for EC2 instances and Kubernetes pods, including interactions with IP addresses during a selected time range.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/profile-panel-drilldown-overall-vpc-volume.html"
            },
            {
                id: 13,
                question: "What is the relationship between Amazon Detective and AWS Organizations?",
                options: [
                    "Detective cannot be used with AWS Organizations accounts",
                    "Detective administrators can enable organization accounts as members",
                    "Organizations automatically creates Detective behavior graphs by default",
                    "Detective replaces Organizations for centralized security management"
                ],
                correct: 1,
                explanation: "The Detective administrator account can enable any organization account as a member account in the organization behavior graph. Organization accounts don't receive invitations - they can be enabled directly. The administrator can also invite accounts outside the organization.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/accounts-orgs-members.html"
            },
            {
                id: 14,
                question: "What type of analysis does Detective perform to help identify the root cause of security issues?",
                options: [
                    "Only signature-based malware scanning for known threats",
                    "Behavioral analysis using historical baselines and patterns",
                    "Only real-time packet inspection for network intrusions",
                    "Static code analysis for application vulnerabilities"
                ],
                correct: 1,
                explanation: "Detective performs behavioral analysis using historical baselines. It analyzes resource behaviors over time, visualizes interactions, and identifies patterns that deviate from normal activity. This helps security teams understand the scope and nature of potential security incidents.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/detective-investigation-about.html"
            },
            {
                id: 15,
                question: "Which entity types can Detective Investigation analyze for suspicious activity?",
                options: [
                    "Only EC2 instances",
                    "Only S3 buckets",
                    "IAM users and IAM roles",
                    "Only Lambda functions"
                ],
                correct: 2,
                explanation: "Detective Investigation specifically analyzes IAM users and IAM roles for anomalous behavior and indicators of compromise. It generates investigation reports with recommended resources to help you determine if these identities are involved in security incidents.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/run-investigations.html"
            },
            {
                id: 16,
                question: "How does Detective pricing work?",
                options: [
                    "Flat monthly fee per account regardless of usage",
                    "Based on the volume of data ingested into behavior graphs",
                    "Per finding analyzed and correlated in investigations",
                    "Free service included with AWS Premium Support plans"
                ],
                correct: 1,
                explanation: "Amazon Detective pricing is based on the volume of data ingested into behavior graphs from enabled data sources. You pay for the amount of log data that Detective analyzes, including data from CloudTrail, VPC Flow Logs, GuardDuty findings, and EKS audit logs.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/what-is-detective.html"
            },
            {
                id: 17,
                question: "What can you do after archiving a GuardDuty finding through Detective?",
                options: [
                    "The finding is permanently deleted",
                    "The finding is archived in GuardDuty",
                    "The finding is moved to a different behavior graph",
                    "The finding triggers an automatic remediation"
                ],
                correct: 1,
                explanation: "When you archive a GuardDuty finding through the Detective console, it archives the finding in GuardDuty. This action helps you manage findings by removing resolved or false-positive findings from the active findings list while preserving them for historical reference.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/analyzing-findings.html"
            },
            {
                id: 18,
                question: "What is required before you can enable Amazon Detective?",
                options: [
                    "AWS Config must be enabled",
                    "Amazon GuardDuty must be enabled for at least 48 hours",
                    "AWS CloudTrail must have a trail configured",
                    "Amazon Inspector must be running scans"
                ],
                correct: 1,
                explanation: "Before enabling Detective, Amazon GuardDuty must be enabled in your account for at least 48 hours in the Region where you want to enable Detective. This allows GuardDuty to generate sufficient baseline data for Detective to analyze.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/detective-prerequisites.html"
            },
            {
                id: 19,
                question: "How many behavior graphs can an administrator account have per Region?",
                options: [
                    "Unlimited",
                    "Up to 5",
                    "One",
                    "Up to 10"
                ],
                correct: 2,
                explanation: "Each administrator account can have only one behavior graph per Region. The behavior graph aggregates data from the administrator account and all invited member accounts within that Region.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/accounts.html"
            },
            {
                id: 20,
                question: "What visualization does Detective provide for finding groups?",
                options: [
                    "Pie charts showing the distribution of finding categories",
                    "Interactive visualization showing entities and findings in incidents",
                    "Bar graphs displaying finding counts over selected time periods",
                    "Heat maps displaying geographic locations of security events"
                ],
                correct: 1,
                explanation: "Detective provides an interactive visualization of each finding group to help you investigate security issues faster and more thoroughly. The Finding Group Visualization panel displays the findings and entities involved in a finding group, making it easier to understand connections and root causes.",
                docLink: "https://docs.aws.amazon.com/detective/latest/userguide/group-visual-finding-group.html"
            }
        ];

        let currentMode = 'learn', answersRevealed = [];
        let currentQuestion = 0;
        let userAnswers = [];
        let shuffledQuestions = [];
        let timerInterval = null;
        let timeRemaining = 0;

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function shuffleQuestionOptions(question) {
            const optionIndices = [0, 1, 2, 3];
            const shuffledIndices = shuffleArray(optionIndices);
            const newQuestion = { ...question };
            newQuestion.options = shuffledIndices.map(i => question.options[i]);
            newQuestion.correct = shuffledIndices.indexOf(question.correct);
            return newQuestion;
        }

        function startQuiz(mode) {
            currentMode = mode;
            currentQuestion = 0;
            userAnswers = new Array(questions.length).fill(null);
            answersRevealed = new Array(questions.length).fill(false);
            shuffledQuestions = shuffleArray(questions).map(q => shuffleQuestionOptions(q));
            document.getElementById('modeSelector').classList.add('hidden');
            document.getElementById('quizContent').classList.remove('hidden');
            document.getElementById('resultsCard').classList.remove('show');
            document.getElementById('totalQ').textContent = shuffledQuestions.length;
            if (mode === 'exam') {
                timeRemaining = shuffledQuestions.length * 150;
                startTimer();
                document.getElementById('shuffleBtn').classList.add('hidden');
            } else {
                document.getElementById('timer').textContent = 'Learn Mode';
                document.getElementById('shuffleBtn').classList.remove('hidden');
            }
            renderQuestion();
        }

        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                if (timeRemaining <= 0) { clearInterval(timerInterval); showResults(); }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const timerEl = document.getElementById('timer');
            timerEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            timerEl.classList.remove('warning', 'danger');
            if (timeRemaining <= 60) timerEl.classList.add('danger');
            else if (timeRemaining <= 300) timerEl.classList.add('warning');
        }

        function renderQuestion() {
            const q = shuffledQuestions[currentQuestion], container = document.getElementById('questionsContainer'), letters = ['A','B','C','D'], ans = userAnswers[currentQuestion], revealed = answersRevealed[currentQuestion];
            let opts = q.options.map((o, i) => { let c = 'option'; if (currentMode === 'learn' && revealed) { c += ' disabled'; if (i === q.correct) c += ' correct'; else if (i === ans && ans !== q.correct) c += ' incorrect'; } else if (ans === i) c += ' selected'; return `<div class="${c}" onclick="selectOption(${i})"><span class="option-marker">${letters[i]}</span><span class="option-text">${o}</span></div>`; }).join('');
            let exp = currentMode === 'learn' ? `<div class="explanation ${revealed ? 'show' : ''}"><div class="explanation-title">üìñ Explanation</div><div class="answer-header">Correct Answer: ${letters[q.correct]}</div><p class="explanation-text">${q.explanation}</p><a href="${q.docLink}" target="_blank" class="doc-link">üìÑ View AWS Documentation ‚Üí</a></div>` : '';
            container.innerHTML = `<div class="question-card"><div class="question-header"><span class="question-number">Question ${currentQuestion + 1}</span><span class="question-domain">Detective</span></div><p class="question-text">${q.question}</p><div class="options">${opts}</div>${currentMode === 'learn' && !revealed ? '<button class="btn btn-primary" style="margin-top:1rem;width:100%;" onclick="revealAnswer()">Show Answer</button>' : ''}${exp}</div>`;
            document.getElementById('currentQ').textContent = currentQuestion + 1; document.getElementById('progressFill').style.width = `${((currentQuestion + 1) / shuffledQuestions.length) * 100}%`; document.getElementById('prevBtn').disabled = currentQuestion === 0; document.getElementById('nextBtn').textContent = currentQuestion === shuffledQuestions.length - 1 ? (currentMode === 'exam' ? 'Submit Quiz' : 'See Results') : 'Next ‚Üí';
        }

        function selectOption(idx) {
            if (currentMode === 'learn' && answersRevealed[currentQuestion]) return;
            userAnswers[currentQuestion] = idx;
            renderQuestion();
        }

        function revealAnswer() {
            if (userAnswers[currentQuestion] === null) userAnswers[currentQuestion] = -1;
            answersRevealed[currentQuestion] = true;
            renderQuestion();
        }

        function navigate(direction) {
            if (direction === 1 && currentQuestion === shuffledQuestions.length - 1) { showResults(); return; }
            currentQuestion += direction;
            currentQuestion = Math.max(0, Math.min(currentQuestion, shuffledQuestions.length - 1));
            renderQuestion();
        }

        function shuffleQuiz() {
            if (currentMode !== 'learn') return;
            currentQuestion = 0;
            userAnswers = new Array(questions.length).fill(null);
            answersRevealed = new Array(questions.length).fill(false);
            shuffledQuestions = shuffleArray(questions).map(q => shuffleQuestionOptions(q));
            renderQuestion();
        }

        function showResults() {
            if (timerInterval) clearInterval(timerInterval);
            let correct = 0;
            shuffledQuestions.forEach((q, idx) => { if (userAnswers[idx] !== null && userAnswers[idx] !== -1 && userAnswers[idx] === q.correct) correct++; });
            const total = shuffledQuestions.length;
            const percentage = Math.round((correct / total) * 100);
            const passed = percentage >= 80;
            document.getElementById('quizContent').classList.add('hidden');
            document.getElementById('resultsCard').classList.add('show');
            const scoreEl = document.getElementById('scorePercent');
            scoreEl.textContent = percentage + '%';
            scoreEl.className = 'results-score ' + (passed ? 'pass' : 'fail');
            const statusEl = document.getElementById('resultStatus');
            statusEl.textContent = passed ? 'üéâ PASSED!' : 'üìö Keep Studying';
            statusEl.className = 'results-status ' + (passed ? 'pass' : 'fail');
            document.getElementById('resultDetails').textContent = `You answered ${correct} out of ${total} questions correctly.`;
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = total - correct;
        }

        function restartQuiz() {
            document.getElementById('resultsCard').classList.remove('show');
            document.getElementById('modeSelector').classList.remove('hidden');
            document.getElementById('quizContent').classList.add('hidden');
            if (timerInterval) clearInterval(timerInterval);
        }
    </script>
</body>
</html>
