<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuardDuty Extended Threat Detection Quiz | AWS Security Specialty (SCS-C03)</title>
    <style>
        :root { --bg-primary: #0a0e17; --bg-secondary: #141b2d; --bg-tertiary: #1a2236; --text-primary: #e2e8f0; --text-secondary: #94a3b8; --accent-primary: #14b8a6; --accent-secondary: #2dd4bf; --success: #22c55e; --error: #ef4444; --warning: #eab308; --info: #3b82f6; --border: #2d3a52; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.6; min-height: 100vh; }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        header { text-align: center; margin-bottom: 2rem; padding: 2rem; background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%); border-radius: 16px; border: 1px solid var(--border); }
        .badge { display: inline-block; background: var(--accent-primary); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; margin-bottom: 1rem; text-transform: uppercase; }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .subtitle { color: var(--text-secondary); font-size: 1rem; }
        .stats-bar { display: flex; justify-content: center; gap: 2rem; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border); }
        .stat { text-align: center; } .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--accent-primary); } .stat-label { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; }
        .mode-selector { display: flex; gap: 1rem; justify-content: center; margin-bottom: 2rem; }
        .mode-btn { padding: 0.75rem 2rem; border: 2px solid var(--border); background: var(--bg-secondary); color: var(--text-primary); border-radius: 8px; cursor: pointer; font-size: 1rem; transition: all 0.3s ease; }
        .mode-btn:hover { border-color: var(--accent-primary); background: var(--bg-tertiary); }
        .mode-btn.active { border-color: var(--accent-primary); background: linear-gradient(135deg, rgba(20, 184, 166, 0.2), rgba(45, 212, 191, 0.1)); }
        .progress-container { background: var(--bg-secondary); border-radius: 12px; padding: 1rem 1.5rem; margin-bottom: 1.5rem; border: 1px solid var(--border); }
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .progress-text { font-size: 0.875rem; color: var(--text-secondary); }
        .timer { font-size: 1.25rem; font-weight: 600; color: var(--accent-primary); font-family: 'Consolas', monospace; }
        .timer.warning { color: var(--warning); animation: pulse 1s infinite; } .timer.danger { color: var(--error); animation: pulse 0.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .progress-bar { height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); border-radius: 4px; transition: width 0.3s ease; }
        .question-card { background: var(--bg-secondary); border-radius: 16px; padding: 2rem; margin-bottom: 1.5rem; border: 1px solid var(--border); }
        .question-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
        .question-number { background: var(--bg-tertiary); color: var(--accent-primary); padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.875rem; font-weight: 600; }
        .question-domain { font-size: 0.75rem; color: var(--text-secondary); background: var(--bg-tertiary); padding: 0.25rem 0.5rem; border-radius: 4px; }
        .question-text { font-size: 1.125rem; margin-bottom: 1.5rem; line-height: 1.7; }
        .options { display: flex; flex-direction: column; gap: 0.75rem; }
        .option { display: flex; align-items: flex-start; gap: 1rem; padding: 1rem; background: var(--bg-tertiary); border: 2px solid var(--border); border-radius: 10px; cursor: pointer; transition: all 0.2s ease; }
        .option:hover:not(.disabled) { border-color: var(--accent-primary); background: rgba(20, 184, 166, 0.1); }
        .option.selected { border-color: var(--accent-primary); border-width: 3px; background: rgba(20, 184, 166, 0.2); box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.25), inset 0 0 12px rgba(20, 184, 166, 0.1); }
        .option.correct { border-color: var(--success); background: rgba(34, 197, 94, 0.15); }
        .option.incorrect { border-color: var(--error); background: rgba(239, 68, 68, 0.15); }
        .option.disabled { cursor: default; }
        .option-marker { width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.875rem; flex-shrink: 0; transition: all 0.2s ease; }
        .option.selected .option-marker { border-color: var(--accent-primary); background: var(--accent-primary); color: white; }
        .option.correct .option-marker { border-color: var(--success); background: var(--success); color: white; }
        .option.incorrect .option-marker { border-color: var(--error); background: var(--error); color: white; }
        .option-text { flex: 1; padding-top: 2px; }
        .explanation { margin-top: 1.5rem; padding: 1.5rem; background: var(--bg-tertiary); border-radius: 10px; border-left: 4px solid var(--info); display: none; }
        .explanation.show { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .explanation-title { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--info); }
        .answer-header { font-weight: 600; color: var(--success); margin-bottom: 0.5rem; }
        .explanation-text { color: var(--text-secondary); margin-bottom: 1rem; line-height: 1.7; }
        .doc-link { display: inline-flex; align-items: center; gap: 0.5rem; color: var(--accent-primary); text-decoration: none; font-size: 0.875rem; padding: 0.5rem 1rem; background: rgba(20, 184, 166, 0.1); border-radius: 6px; transition: all 0.2s ease; }
        .doc-link:hover { background: rgba(20, 184, 166, 0.2); }
        .btn-container { display: flex; justify-content: space-between; gap: 1rem; margin-top: 1rem; }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-secondary:hover { border-color: var(--accent-primary); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(20, 184, 166, 0.4); }
        .results-card { background: var(--bg-secondary); border-radius: 16px; padding: 2rem; text-align: center; border: 1px solid var(--border); display: none; }
        .results-card.visible { display: block; animation: fadeIn 0.5s ease; }
        .results-card h2 { font-size: 1.5rem; margin-bottom: 1rem; color: var(--text-secondary); }
        .results-score { font-size: 4rem; font-weight: 700; margin: 1rem 0; }
        .results-score.pass { color: var(--success); }
        .results-score.fail { color: var(--error); }
        .results-status { font-size: 1.5rem; margin-bottom: 1rem; }
        .results-status.pass { color: var(--success); }
        .results-status.fail { color: var(--error); }
        .results-details { color: var(--text-secondary); margin-bottom: 2rem; }
        .results-breakdown { display: flex; justify-content: center; gap: 3rem; margin-bottom: 2rem; padding: 1.5rem; background: var(--bg-tertiary); border-radius: 10px; }
        .breakdown-item { text-align: center; }
        .breakdown-value { font-size: 2rem; font-weight: 700; }
        .breakdown-value.correct { color: var(--success); }
        .breakdown-value.incorrect { color: var(--error); }
        .breakdown-label { font-size: 0.875rem; color: var(--text-secondary); }
        .hidden { display: none !important; }
        .shuffle-notice { text-align: center; padding: 0.75rem; background: rgba(20, 184, 166, 0.1); border-radius: 8px; margin-bottom: 1.5rem; color: var(--accent-secondary); font-size: 0.875rem; }
        .btn-group { display: flex; gap: 1rem; justify-content: center; margin-top: 1rem; }
        .review-section { background: var(--bg-secondary); border-radius: 16px; padding: 2rem; border: 1px solid var(--border); display: none; }
        .review-section.show { display: block; animation: fadeIn 0.5s ease; }
        .review-header { text-align: center; margin-bottom: 2rem; }
        .review-hint { text-align: center; color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem; }
        .review-table { width: 100%; border-collapse: collapse; margin-bottom: 2rem; }
        .review-table th { background: var(--bg-tertiary); color: var(--text-secondary); font-size: 0.875rem; font-weight: 600; text-transform: uppercase; padding: 1rem; text-align: left; border-bottom: 2px solid var(--border); }
        .review-table td { padding: 1rem; border-bottom: 1px solid var(--border); vertical-align: top; }
        .review-table tbody tr { cursor: pointer; transition: all 0.2s ease; }
        .review-table tbody tr:hover { background: rgba(20, 184, 166, 0.1); transform: translateX(4px); }
        .review-table tbody tr.reviewed { background: rgba(20, 184, 166, 0.25); border-left: 6px solid var(--accent-primary); box-shadow: inset 0 0 20px rgba(20, 184, 166, 0.15); }
        .review-table tbody tr.reviewed:hover { background: rgba(20, 184, 166, 0.3); }
        .review-table tbody tr.reviewed .review-q-num { color: var(--accent-secondary); font-weight: 800; }
        .review-table tbody tr.reviewed .review-q-num::before { content: "‚úì "; color: var(--accent-primary); font-size: 1rem; }
        .review-q-num { font-weight: 700; color: var(--accent-primary); white-space: nowrap; }
        .review-q-text { color: var(--text-primary); line-height: 1.6; }
        .review-answer { font-weight: 600; }
        .review-answer.correct { color: var(--success); }
        .review-answer.incorrect { color: var(--error); }
        .review-status { text-align: center; font-size: 1.25rem; }
        @media (max-width: 640px) { .container { padding: 1rem; } h1 { font-size: 1.5rem; } .stats-bar { gap: 1rem; } .mode-selector, .btn-container, .results-breakdown { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <span class="badge">Domain 1: Detection</span>
            <h1>üî• GuardDuty Extended Threat Detection</h1>
            <p class="subtitle">Comprehensive Quiz for AWS Security Specialty (SCS-C03)</p>
            <div class="stats-bar">
                <div class="stat"><div class="stat-value">15</div><div class="stat-label">Questions</div></div>
                <div class="stat"><div class="stat-value">80%</div><div class="stat-label">Pass Score</div></div>
                <div class="stat"><div class="stat-value">37:30</div><div class="stat-label">Exam Time</div></div>
            </div>
        </header>
        <div class="mode-selector" id="modeSelector">
            <button class="mode-btn" onclick="startQuiz('learn')">üìö Learn Mode</button>
            <button class="mode-btn" onclick="startQuiz('exam')">‚è±Ô∏è Exam Mode</button>
        </div>

        <div id="quizContent" class="hidden">
        <div class="progress-container">
            <div class="progress-header">
                    <span class="progress-text">Question <span id="currentQ">1</span> of <span id="totalQ">15</span></span>
                    <span class="timer" id="timer">37:30</span>
            </div>
            <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>
            <div class="shuffle-notice" id="shuffleNotice">üîÄ Questions and options have been randomized</div>
            <div id="questionsContainer"></div>
            <div class="btn-container">
                <button class="btn btn-secondary" id="backToReviewBtn" onclick="backToReview()" style="display: none;">‚Üê Back to Review</button>
                <button class="btn btn-secondary" id="prevBtn" onclick="navigate(-1)" disabled>‚Üê Previous</button>
                <button class="btn btn-secondary" id="shuffleBtn" onclick="shuffleQuiz()">üîÄ Shuffle</button>
                <button class="btn btn-primary" id="nextBtn" onclick="navigate(1)">Next ‚Üí</button>
                </div>
            </div>

        <div class="results-card" id="resultsCard">
            <h2>Quiz Complete!</h2>
            <div class="results-score" id="scorePercent">0%</div>
            <div class="results-status" id="resultStatus">-</div>
            <p class="results-details" id="resultDetails"></p>
            <div class="results-breakdown">
                <div class="breakdown-item">
                    <div class="breakdown-value correct" id="correctCount">0</div>
                    <div class="breakdown-label">Correct</div>
                </div>
                <div class="breakdown-item">
                    <div class="breakdown-value incorrect" id="incorrectCount">0</div>
                    <div class="breakdown-label">Incorrect</div>
                </div>
                    </div>
            <div class="btn-group" id="resultsButtons">
                <button class="btn btn-primary" onclick="showReview()">üìä Review Answers</button>
                <button class="btn btn-secondary" onclick="restartQuiz()">üîÑ Restart Quiz</button>
            </div>
                </div>

        <div class="review-section" id="reviewSection">
            <div class="review-header">
                <h2>Answer Review</h2>
                <p class="results-details">Click any question to review the full answer and explanation</p>
            </div>
            <p class="review-hint">üí° Tip: Click on any row to see the full question and explanation in Learn mode</p>
            <table class="review-table">
                <thead>
                    <tr>
                        <th style="width: 5%">#</th>
                        <th style="width: 50%">Question</th>
                        <th style="width: 15%">Your Answer</th>
                        <th style="width: 15%">Correct Answer</th>
                        <th style="width: 10%">Status</th>
                    </tr>
                </thead>
                <tbody id="reviewTableBody"></tbody>
            </table>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="backToResults()">‚Üê Back to Results</button>
                <button class="btn btn-primary" onclick="restartQuiz()">üîÑ Restart Quiz</button>
            </div>
        </div>
            </div>

    <script>
        const questions = [
            {
                id: 1,
                question: "What is GuardDuty Extended Threat Detection primarily designed to detect?",
                options: [
                    "Single API call anomalies in real-time",
                    "Multi-stage attacks that span data sources, resource types, and time",
                    "Configuration drift in AWS resources",
                    "Network bandwidth anomalies"
                ],
                correct: 1,
                explanation: "GuardDuty Extended Threat Detection automatically detects multi-stage attacks that span data sources, multiple types of AWS resources, and time within an AWS account. It correlates multiple events including API activities and GuardDuty findings (called 'signals') to identify scenarios that present a potential threat.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-extended-threat-detection.html"
            },
            {
                id: 2,
                question: "What severity level does GuardDuty assign to all attack sequence finding types?",
                options: [
                    "High",
                    "Medium to High (varies by attack type)",
                    "Critical",
                    "Severity is determined dynamically based on impact"
                ],
                correct: 2,
                explanation: "Because of the nature of the associated threat scenarios, GuardDuty considers ALL attack sequence finding types as Critical. This reflects the serious nature of multi-stage attacks that typically indicate active compromise.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_findings-severity.html#guardduty-finding-severity-level-critical"
            },
            {
                id: 3,
                question: "When you enable GuardDuty in a Region, what happens with Extended Threat Detection?",
                options: [
                    "It is enabled automatically at no additional cost",
                    "You must enable it separately with a 30-day free trial",
                    "It requires Runtime Monitoring to be enabled first",
                    "It is only available in the management account"
                ],
                correct: 0,
                explanation: "When you enable GuardDuty in a Region, Extended Threat Detection is enabled automatically by default at no additional cost. There's no need to configure or enable it separately.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-extended-threat-detection.html"
            },
            {
                id: 4,
                question: "What are the five attack sequence finding types in Extended Threat Detection?",
                options: [
                    "IAM, EC2, S3, Lambda, RDS",
                    "Recon, InitialAccess, Persistence, Exfiltration, Impact",
                    "EKS/CompromisedCluster, ECS/CompromisedCluster, EC2/CompromisedInstanceGroup, IAM/CompromisedCredentials, S3/CompromisedData",
                    "High, Critical, Low, Medium, Informational"
                ],
                correct: 2,
                explanation: "The five attack sequence finding types are: AttackSequence:EKS/CompromisedCluster, AttackSequence:ECS/CompromisedCluster, AttackSequence:EC2/CompromisedInstanceGroup, AttackSequence:IAM/CompromisedCredentials, and AttackSequence:S3/CompromisedData. All are classified as Critical severity.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-attack-sequence-finding-types.html"
            },
            {
                id: 5,
                question: "What is the rolling time window that Extended Threat Detection uses to identify attack sequences?",
                options: [
                    "1 hour",
                    "12 hours",
                    "24 hours",
                    "7 days"
                ],
                correct: 2,
                explanation: "GuardDuty Extended Threat Detection is designed to identify potential in-progress or recent attack behaviors within a 24-hour rolling time window in your account. This allows detection of attack sequences where different stages may occur over several hours.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-extended-threat-detection.html#extended-threat-detection-how-it-works"
            },
            {
                id: 6,
                question: "How does Extended Threat Detection handle findings that are archived due to suppression rules?",
                options: [
                    "Includes them with lower weight in correlation analysis",
                    "Does not consider them for attack sequence correlation",
                    "Automatically unarchives them when part of a detected sequence",
                    "Creates duplicate findings for correlation purposes"
                ],
                correct: 1,
                explanation: "Extended Threat Detection doesn't consider archived findings, including those automatically archived because of suppression rules. This ensures only active, relevant signals contribute to attack sequence detection. You should review existing suppression rules to ensure you're not missing important signals.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/findings_suppression-rule.html#using-suppression-rules-with-extended-threat-detection"
            },
            {
                id: 7,
                question: "What is a 'weak signal' in GuardDuty Extended Threat Detection?",
                options: [
                    "A finding with Low severity that is usually ignored",
                    "An individual API activity that alone is not suspicious but may indicate reconnaissance",
                    "A network connection with low bandwidth usage",
                    "A finding that has been suppressed by a rule"
                ],
                correct: 1,
                explanation: "A weak signal is an individual API activity or behavior that alone might not be suspicious enough to warrant a standalone finding, but when correlated with other activities, may indicate reconnaissance, credential access, or lateral movement as part of a multi-stage attack.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-extended-threat-detection.html#extended-threat-detection-how-it-works"
            },
            {
                id: 8,
                question: "Which protection plans should be enabled for maximum EKS coverage with Extended Threat Detection?",
                options: [
                    "Only EKS Audit Log Monitoring",
                    "Only Runtime Monitoring for EKS",
                    "S3 Protection and Lambda Protection",
                    "Both EKS Protection (audit logs) and Runtime Monitoring"
                ],
                correct: 3,
                explanation: "For maximum EKS coverage, GuardDuty recommends enabling both EKS Protection and Runtime Monitoring. EKS Protection monitors control plane activities through audit logs (RBAC changes, privileged pod creation), while Runtime Monitoring observes container-level behaviors (cryptomining, malicious processes). Together, they detect complex attack patterns.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-extended-threat-detection.html#extended-threat-detection-eks-clusters"
            },
            {
                id: 9,
                question: "What happens when Extended Threat Detection identifies an attack sequence?",
                options: [
                    "It automatically remediates the threat and notifies Security Hub",
                    "It generates a Critical severity finding and includes references to correlated signals",
                    "It archives all related findings to reduce noise",
                    "It triggers an AWS Lambda function for automated response"
                ],
                correct: 1,
                explanation: "When Extended Threat Detection identifies an attack sequence, it generates a Critical severity finding in GuardDuty. The finding includes details about the attack stages and references to the correlated signals (findings and API activities) that contributed to detecting the sequence.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-extended-threat-detection.html"
            },
            {
                id: 10,
                question: "How does Extended Threat Detection differ from standard GuardDuty findings?",
                options: [
                    "Extended Threat Detection only works with Runtime Monitoring data",
                    "Standard findings identify isolated events; Extended correlates multiple events over time",
                    "Extended Threat Detection has lower severity thresholds",
                    "Standard findings are regional; Extended is global"
                ],
                correct: 1,
                explanation: "Standard GuardDuty findings typically identify isolated suspicious events or activities. Extended Threat Detection goes further by correlating multiple events (both findings and weak signals) across data sources, resource types, and time to identify multi-stage attack sequences that indicate more sophisticated threats.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-extended-threat-detection.html"
            },
            {
                id: 11,
                question: "Which of the following is considered a signal in Extended Threat Detection?",
                options: [
                    "Only GuardDuty findings with High or Critical severity",
                    "Both GuardDuty findings and individual API activities",
                    "Only CloudTrail management events",
                    "Only Runtime Monitoring agent data"
                ],
                correct: 1,
                explanation: "Extended Threat Detection uses 'signals' which include both existing GuardDuty findings (of any severity) and individual API activities that might not trigger standalone findings. This allows it to detect attack patterns that involve both obvious malicious activity and subtle reconnaissance behaviors.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-extended-threat-detection.html#extended-threat-detection-how-it-works"
            },
            {
                id: 12,
                question: "What is the typical attack pattern that Extended Threat Detection is designed to identify in EKS environments?",
                options: [
                    "Direct pod deletion from unauthorized IP addresses",
                    "Reconnaissance via API calls, privilege escalation, and cryptomining execution",
                    "Misconfigured security groups allowing external access",
                    "Outdated EKS versions vulnerable to known CVEs"
                ],
                correct: 1,
                explanation: "Extended Threat Detection in EKS environments looks for multi-stage attacks such as: initial reconnaissance through Kubernetes API calls, privilege escalation through RBAC manipulation or privileged pod creation, followed by malicious activity like cryptomining or data exfiltration.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-extended-threat-detection.html#extended-threat-detection-eks-clusters"
            },
            {
                id: 13,
                question: "Can Extended Threat Detection identify attacks that span multiple AWS accounts?",
                options: [
                    "Yes, when using AWS Organizations with a delegated administrator",
                    "No, it only correlates events within a single AWS account",
                    "Yes, but only for accounts in the same Region",
                    "Yes, but requires cross-account IAM roles to be configured"
                ],
                correct: 1,
                explanation: "Extended Threat Detection correlates events and identifies attack sequences within a single AWS account. It does not currently correlate activities across multiple AWS accounts, even within an AWS Organization. Each account's Extended Threat Detection operates independently.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-extended-threat-detection.html#extended-threat-detection-how-it-works"
            },
            {
                id: 14,
                question: "What should you do if Extended Threat Detection generates an attack sequence finding?",
                options: [
                    "Immediately disable the affected resources to prevent further damage",
                    "Review the finding details, correlated signals, and investigate the attack timeline",
                    "Archive the finding after verifying it's a false positive",
                    "Wait for additional findings to confirm the attack pattern"
                ],
                correct: 1,
                explanation: "When Extended Threat Detection generates an attack sequence finding, you should immediately review the finding details including the attack stages, correlated signals (findings and API activities), affected resources, and timeline. Use this information to understand the attack scope and implement appropriate incident response procedures. Consider using Amazon Detective for deeper investigation.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-extended-threat-detection.html"
            },
            {
                id: 15,
                question: "How does Extended Threat Detection help reduce alert fatigue?",
                options: [
                    "By automatically archiving all Low and Medium severity findings",
                    "By correlating multiple weak signals into a single Critical finding with context",
                    "By only generating findings during business hours",
                    "By integrating with AWS Chatbot to filter non-critical alerts"
                ],
                correct: 1,
                explanation: "Extended Threat Detection helps reduce alert fatigue by correlating multiple weak signals and lower-severity events into a single, high-confidence Critical severity finding. Instead of investigating dozens of potentially unrelated events, security teams can focus on consolidated attack sequence findings with full context about the attack stages and involved resources.",
                docLink: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty-extended-threat-detection.html"
            }
        ];

        let currentQuestion = 0;
        let userAnswers = [];
        let shuffledQuestions = [];
        let timerInterval = null;
        let timeRemaining = 0;
        let currentMode = 'learn';
        let answersRevealed = [];
        let inReviewMode = false, reviewedQuestions = [];

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function shuffleQuestionOptions(question) {
            const indices = [0, 1, 2, 3];
            const shuffledIndices = shuffleArray(indices);
            const shuffledOptions = shuffledIndices.map(i => question.options[i]);
            const newCorrectIndex = shuffledIndices.indexOf(question.correct);

            return {
                ...question,
                options: shuffledOptions,
                correct: newCorrectIndex
            };
        }

        function startQuiz(mode) {
            inReviewMode = false;
            reviewedQuestions = [];
            currentMode = mode;
            currentQuestion = 0;
            userAnswers = new Array(questions.length).fill(null);
            answersRevealed = new Array(questions.length).fill(false);
            shuffledQuestions = shuffleArray(questions).map(q => shuffleQuestionOptions(q));

            document.getElementById('modeSelector').classList.add('hidden');
            document.getElementById('quizContent').classList.remove('hidden');
            document.getElementById('resultsCard').classList.remove('visible');
            document.getElementById('reviewSection').classList.remove('show');
            document.getElementById('backToReviewBtn').style.display = 'none';

            document.getElementById('totalQ').textContent = shuffledQuestions.length;

            if (mode === 'exam') {
                timeRemaining = shuffledQuestions.length * 150; // 2.5 min per question
                startTimer();
                document.getElementById('shuffleBtn').classList.add('hidden');
            } else {
                stopTimer();
                document.getElementById('timer').textContent = 'Learn Mode';
                document.getElementById('shuffleBtn').classList.remove('hidden');
            }
            renderQuestion();
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                if (timeRemaining <= 0) {
                    stopTimer();
                    alert('‚è∞ Time is up! Your quiz will be submitted automatically.');
                    showResults();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerEl = document.getElementById('timer');
            timerEl.textContent = formatTime(timeRemaining);

            const totalTime = shuffledQuestions.length * 150;
            const percentRemaining = (timeRemaining / totalTime) * 100;
            
            timerEl.classList.remove('warning', 'danger');
            if (percentRemaining <= 10) {
                timerEl.classList.add('danger');
            } else if (percentRemaining <= 25) {
                timerEl.classList.add('warning');
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function renderQuestion() {
            if (shuffledQuestions.length === 0) return;

            const q = shuffledQuestions[currentQuestion];
            const container = document.getElementById('questionsContainer');

                const letters = ['A', 'B', 'C', 'D'];
            const userAnswer = userAnswers[currentQuestion];
            const revealed = answersRevealed[currentQuestion];

            let optionsHtml = q.options.map((opt, idx) => {
                let classes = 'option';
                if (currentMode === 'learn' && revealed) {
                    classes += ' disabled';
                    if (idx === q.correct) classes += ' correct';
                    else if (idx === userAnswer && userAnswer !== q.correct) classes += ' incorrect';
                } else if (userAnswer === idx) {
                    classes += ' selected';
                }

                return `
                    <div class="${classes}" onclick="selectOption(${idx})">
                        <span class="option-marker">${letters[idx]}</span>
                        <span class="option-text">${opt}</span>
                    </div>
                `;
            }).join('');

            let explanationHtml = '';
            if (currentMode === 'learn' && revealed) {
                explanationHtml = `
                    <div class="explanation show">
                        <div class="answer-header">‚úì Correct Answer: ${letters[q.correct]}</div>
                        <p class="explanation-text">${q.explanation}</p>
                        <a href="${q.docLink}" target="_blank" class="doc-link">üìÑ View AWS Documentation ‚Üí</a>
                    </div>
                `;
            }

            container.innerHTML = `
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-number">Question ${currentQuestion + 1}</span>
                        <span class="question-domain">GuardDuty</span>
                    </div>
                    <p class="question-text">${q.question}</p>
                    <div class="options">${optionsHtml}</div>
                    ${currentMode === 'learn' && !revealed ?
                        '<button class="btn btn-primary" style="margin-top: 1rem; width: 100%;" onclick="revealAnswer()">Show Answer</button>' : ''}
                    ${explanationHtml}
                </div>
            `;

            document.getElementById('currentQ').textContent = currentQuestion + 1;
            document.getElementById('progressFill').style.width =
                `${((currentQuestion + 1) / shuffledQuestions.length) * 100}%`;

            document.getElementById('prevBtn').disabled = currentQuestion === 0;

            const nextBtn = document.getElementById('nextBtn');
            if (currentQuestion === shuffledQuestions.length - 1) {
                nextBtn.textContent = currentMode === 'exam' ? 'Submit Quiz' : 'See Results';
            } else {
                nextBtn.textContent = 'Next ‚Üí';
            }
        }

        function selectOption(idx) {
            if (currentMode === 'learn' && answersRevealed[currentQuestion]) return;

            userAnswers[currentQuestion] = idx;
            renderQuestion();
        }

        function revealAnswer() {
            if (userAnswers[currentQuestion] === null) {
                userAnswers[currentQuestion] = -1;
            }
            answersRevealed[currentQuestion] = true;
            renderQuestion();
        }

        function navigate(direction) {
            if (direction === 1 && currentQuestion === shuffledQuestions.length - 1) {
                showResults();
                    return;
            }

            currentQuestion += direction;
            currentQuestion = Math.max(0, Math.min(currentQuestion, shuffledQuestions.length - 1));
            renderQuestion();
        }

        function shuffleQuiz() {
            if (currentMode !== 'learn') return;

            currentQuestion = 0;
            userAnswers = new Array(questions.length).fill(null);
            answersRevealed = new Array(questions.length).fill(false);
            shuffledQuestions = shuffleArray(questions).map(q => shuffleQuestionOptions(q));
            renderQuestion();

            const notice = document.getElementById('shuffleNotice');
            notice.style.animation = 'none';
            notice.offsetHeight;
            notice.style.animation = 'fadeIn 0.5s ease';
        }

        function showResults() {
            if (timerInterval) clearInterval(timerInterval);

            let correct = 0;
            let answered = 0;

            for (let i = 0; i < shuffledQuestions.length; i++) {
                if (userAnswers[i] !== null && userAnswers[i] !== -1) {
                    answered++;
                    if (userAnswers[i] === shuffledQuestions[i].correct) {
                        correct++;
                    }
                }
            }

            const total = shuffledQuestions.length;
            const percentage = Math.round((correct / total) * 100);
            const passed = percentage >= 80;

            document.getElementById('quizContent').classList.add('hidden');
            document.getElementById('reviewSection').classList.remove('show');
            document.getElementById('resultsCard').classList.add('visible');

            const scoreEl = document.getElementById('scorePercent');
            scoreEl.textContent = percentage + '%';
            scoreEl.className = 'results-score ' + (passed ? 'pass' : 'fail');

            const statusEl = document.getElementById('resultStatus');
            statusEl.textContent = passed ? 'üéâ PASSED!' : 'üìö Keep Studying';
            statusEl.className = 'results-status ' + (passed ? 'pass' : 'fail');

            document.getElementById('resultDetails').textContent =
                `You answered ${correct} out of ${total} questions correctly. ${passed ? 'Great job!' : 'You need 80% to pass.'}`;

            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = total - correct;


            document.getElementById('resultsCard').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function restartQuiz() {
            currentQuestion = 0;
            userAnswers = new Array(questions.length).fill(null);
            answersRevealed = new Array(questions.length).fill(false);
            shuffledQuestions = shuffleArray(questions).map(q => shuffleQuestionOptions(q));

            document.getElementById('resultsCard').classList.remove('visible');
            document.getElementById('reviewSection').classList.remove('show');
            document.getElementById('backToReviewBtn').style.display = 'none';
            document.getElementById('quizContent').classList.add('hidden');
            document.getElementById('modeSelector').classList.remove('hidden');

            stopTimer();
            inReviewMode = false;
            reviewedQuestions = [];
        }

        function showReview() {
            const letters = ['A','B','C','D'];
            const tbody = document.getElementById('reviewTableBody');
            tbody.innerHTML = shuffledQuestions.map((q, i) => {
                const userAns = userAnswers[i];
                const isCorrect = userAns === q.correct;
                const userLetter = userAns !== null && userAns >= 0 ? letters[userAns] : 'No Answer';
                const correctLetter = letters[q.correct];
                const statusIcon = isCorrect ? '‚úì' : '‚úó';
                const statusClass = isCorrect ? 'correct' : 'incorrect';
                const qText = q.question.length > 120 ? q.question.substring(0, 120) + '...' : q.question;
                const reviewedClass = reviewedQuestions.includes(i) ? 'reviewed' : '';
                return `<tr class="${reviewedClass}" onclick="reviewQuestion(${i})"><td class="review-q-num">${i + 1}</td><td class="review-q-text">${qText}</td><td class="review-answer ${userAns === q.correct ? 'correct' : 'incorrect'}">${userLetter}</td><td class="review-answer correct">${correctLetter}</td><td class="review-status ${statusClass}">${statusIcon}</td></tr>`;
            }).join('');
            document.getElementById('resultsCard').classList.remove('visible');
            document.getElementById('reviewSection').classList.add('show');
            inReviewMode = true;
        }

        function reviewQuestion(qIndex) {
            if (!reviewedQuestions.includes(qIndex)) {
                reviewedQuestions.push(qIndex);
            }
            currentMode = 'learn';
            currentQuestion = qIndex;
            answersRevealed[qIndex] = true;
            document.getElementById('reviewSection').classList.remove('show');
            document.getElementById('quizContent').classList.remove('hidden');
            document.getElementById('timer').textContent = 'Learn Mode';
            document.getElementById('shuffleBtn').style.display = 'none';
            document.getElementById('backToReviewBtn').style.display = 'inline-block';
            stopTimer();
            renderQuestion();
        }

        function backToReview() {
            document.getElementById('quizContent').classList.add('hidden');
            showReview();
        }

        function backToResults() {
            document.getElementById('reviewSection').classList.remove('show');
            document.getElementById('resultsCard').classList.add('visible');
            inReviewMode = false;
        }
    </script>
</body>
</html>
