<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IAM Policies & Permissions Quiz | AWS Security Specialty (SCS-C03)</title>
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #141b2d;
            --bg-tertiary: #1a2236;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --accent-primary: #f59e0b;
            --accent-secondary: #fbbf24;
            --success: #22c55e;
            --error: #ef4444;
            --warning: #eab308;
            --info: #3b82f6;
            --border: #2d3a52;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.6; min-height: 100vh; }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        header { text-align: center; margin-bottom: 2rem; padding: 2rem; background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%); border-radius: 16px; border: 1px solid var(--border); }
        .badge { display: inline-block; background: var(--accent-primary); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; margin-bottom: 1rem; text-transform: uppercase; }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .subtitle { color: var(--text-secondary); font-size: 1rem; }
        .stats-bar { display: flex; justify-content: center; gap: 2rem; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border); }
        .stat { text-align: center; }
        .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--accent-primary); }
        .stat-label { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; }
        .mode-selector { display: flex; gap: 1rem; justify-content: center; margin-bottom: 2rem; }
        .mode-btn { padding: 0.75rem 2rem; border: 2px solid var(--border); background: var(--bg-secondary); color: var(--text-primary); border-radius: 8px; cursor: pointer; font-size: 1rem; transition: all 0.3s ease; }
        .mode-btn:hover { border-color: var(--accent-primary); background: var(--bg-tertiary); }
        .progress-container { background: var(--bg-secondary); border-radius: 12px; padding: 1rem 1.5rem; margin-bottom: 1.5rem; border: 1px solid var(--border); }
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .progress-text { font-size: 0.875rem; color: var(--text-secondary); }
        .timer { font-size: 1.25rem; font-weight: 600; color: var(--accent-primary); font-family: 'Consolas', monospace; }
        .timer.warning { color: var(--warning); animation: pulse 1s infinite; }
        .timer.danger { color: var(--error); animation: pulse 0.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .progress-bar { height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); border-radius: 4px; transition: width 0.3s ease; }
        .question-card { background: var(--bg-secondary); border-radius: 16px; padding: 2rem; margin-bottom: 1.5rem; border: 1px solid var(--border); }
        .question-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
        .question-number { background: var(--bg-tertiary); color: var(--accent-primary); padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.875rem; font-weight: 600; }
        .question-domain { font-size: 0.75rem; color: var(--text-secondary); background: var(--bg-tertiary); padding: 0.25rem 0.5rem; border-radius: 4px; }
        .question-text { font-size: 1.125rem; margin-bottom: 1.5rem; line-height: 1.7; }
        .options { display: flex; flex-direction: column; gap: 0.75rem; }
        .option { display: flex; align-items: flex-start; gap: 1rem; padding: 1rem; background: var(--bg-tertiary); border: 2px solid var(--border); border-radius: 10px; cursor: pointer; transition: all 0.2s ease; }
        .option:hover:not(.disabled) { border-color: var(--accent-primary); background: rgba(245, 158, 11, 0.1); }
        .option.selected { border-color: var(--accent-primary); border-width: 3px; background: rgba(245, 158, 11, 0.2); box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.25), inset 0 0 12px rgba(245, 158, 11, 0.1); }
        .option.correct { border-color: var(--success); background: rgba(34, 197, 94, 0.15); }
        .option.incorrect { border-color: var(--error); background: rgba(239, 68, 68, 0.15); }
        .option.disabled { cursor: default; }
        .option-marker { width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.875rem; flex-shrink: 0; }
        .option.selected .option-marker { border-color: var(--accent-primary); background: var(--accent-primary); color: white; }
        .option.correct .option-marker { border-color: var(--success); background: var(--success); color: white; }
        .option.incorrect .option-marker { border-color: var(--error); background: var(--error); color: white; }
        .option-text { flex: 1; padding-top: 2px; }
        .explanation { margin-top: 1.5rem; padding: 1.5rem; background: var(--bg-tertiary); border-radius: 10px; border-left: 4px solid var(--info); display: none; }
        .explanation.show { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .explanation-title { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--info); }
        .answer-header { font-weight: 600; color: var(--success); margin-bottom: 0.5rem; }
        .explanation-text { color: var(--text-secondary); margin-bottom: 1rem; }
        .doc-link { display: inline-flex; align-items: center; gap: 0.5rem; color: var(--accent-primary); text-decoration: none; font-size: 0.875rem; padding: 0.5rem 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 6px; }
        .doc-link:hover { background: rgba(245, 158, 11, 0.2); }
        .btn-container { display: flex; justify-content: space-between; gap: 1rem; margin-top: 1rem; }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .btn-primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4); }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-secondary:hover { border-color: var(--accent-primary); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .results-card { background: var(--bg-secondary); border-radius: 16px; padding: 2rem; text-align: center; border: 1px solid var(--border); display: none; }
        .results-card.show { display: block; animation: fadeIn 0.5s ease; }
        .results-score { font-size: 4rem; font-weight: 700; margin: 1rem 0; }
        .results-score.pass { color: var(--success); }
        .results-score.fail { color: var(--error); }
        .results-status { font-size: 1.5rem; margin-bottom: 1rem; }
        .results-status.pass { color: var(--success); }
        .results-status.fail { color: var(--error); }
        .results-details { color: var(--text-secondary); margin-bottom: 2rem; }
        .results-breakdown { display: flex; justify-content: center; gap: 3rem; margin-bottom: 2rem; padding: 1.5rem; background: var(--bg-tertiary); border-radius: 10px; }
        .breakdown-item { text-align: center; }
        .breakdown-value { font-size: 2rem; font-weight: 700; }
        .breakdown-value.correct { color: var(--success); }
        .breakdown-value.incorrect { color: var(--error); }
        .breakdown-label { font-size: 0.875rem; color: var(--text-secondary); }
        .hidden { display: none !important; }
        .shuffle-notice { text-align: center; padding: 0.75rem; background: rgba(245, 158, 11, 0.1); border-radius: 8px; margin-bottom: 1.5rem; color: var(--accent-secondary); font-size: 0.875rem; }
        .btn-group { display: flex; gap: 1rem; justify-content: center; margin-top: 1rem; }
        .review-section { background: var(--bg-secondary); border-radius: 16px; padding: 2rem; border: 1px solid var(--border); display: none; }
        .review-section.show { display: block; animation: fadeIn 0.5s ease; }
        .review-header { text-align: center; margin-bottom: 2rem; }
        .review-hint { text-align: center; color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem; }
        .review-table { width: 100%; border-collapse: collapse; margin-bottom: 2rem; }
        .review-table th { background: var(--bg-tertiary); color: var(--text-secondary); font-size: 0.875rem; font-weight: 600; text-transform: uppercase; padding: 1rem; text-align: left; border-bottom: 2px solid var(--border); }
        .review-table td { padding: 1rem; border-bottom: 1px solid var(--border); vertical-align: top; }
        .review-table tbody tr { cursor: pointer; transition: all 0.2s ease; }
        .review-table tbody tr:hover { background: rgba(245, 158, 11, 0.1); transform: translateX(4px); }
        .review-table tbody tr.reviewed { background: rgba(245, 158, 11, 0.25); border-left: 6px solid var(--accent-primary); box-shadow: inset 0 0 20px rgba(245, 158, 11, 0.15); }
        .review-table tbody tr.reviewed:hover { background: rgba(245, 158, 11, 0.3); }
        .review-table tbody tr.reviewed .review-q-num { color: var(--accent-secondary); font-weight: 800; }
        .review-table tbody tr.reviewed .review-q-num::before { content: "‚úì "; color: var(--accent-primary); font-size: 1rem; }
        .review-q-num { font-weight: 700; color: var(--accent-primary); white-space: nowrap; }
        .review-q-text { color: var(--text-primary); line-height: 1.6; }
        .review-answer { font-weight: 600; }
        .review-answer.correct { color: var(--success); }
        .review-answer.incorrect { color: var(--error); }
        .review-status { text-align: center; font-size: 1.25rem; }
        @media (max-width: 640px) { .container { padding: 1rem; } h1 { font-size: 1.5rem; } .stats-bar { gap: 1rem; } .mode-selector, .btn-container, .results-breakdown, .btn-group { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <span class="badge">Domain 4: Identity & Access Management (20%)</span>
            <h1>IAM Policies & Permissions</h1>
            <p class="subtitle">Comprehensive Quiz for AWS Security Specialty (SCS-C03)</p>
            <div class="stats-bar">
                <div class="stat"><div class="stat-value">25</div><div class="stat-label">Questions</div></div>
                <div class="stat"><div class="stat-value">80%</div><div class="stat-label">Pass Score</div></div>
                <div class="stat"><div class="stat-value">62:30</div><div class="stat-label">Exam Time</div></div>
            </div>
        </header>
        <div class="mode-selector" id="modeSelector">
            <button class="mode-btn" onclick="startQuiz('learn')">üìö Learn Mode</button>
            <button class="mode-btn" onclick="startQuiz('exam')">‚è±Ô∏è Exam Mode</button>
        </div>
        <div id="quizContent" class="hidden">
            <div class="progress-container">
                <div class="progress-header">
                    <span class="progress-text">Question <span id="currentQ">1</span> of <span id="totalQ">25</span></span>
                    <span class="timer" id="timer">62:30</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
            </div>
            <div class="shuffle-notice" id="shuffleNotice">üîÄ Questions and options have been randomized</div>
            <div id="questionsContainer"></div>
            <div class="btn-container">
                <button class="btn btn-secondary" id="backToReviewBtn" onclick="backToReview()" style="display: none;">‚Üê Back to Review</button>
                <button class="btn btn-secondary" id="prevBtn" onclick="navigate(-1)" disabled>‚Üê Previous</button>
                <button class="btn btn-secondary" id="shuffleBtn" onclick="shuffleQuiz()">üîÄ Shuffle</button>
                <button class="btn btn-primary" id="nextBtn" onclick="navigate(1)">Next ‚Üí</button>
            </div>
        </div>
        <div class="results-card" id="resultsCard">
            <h2>Quiz Complete!</h2>
            <div class="results-score" id="scorePercent">0%</div>
            <div class="results-status" id="resultStatus">-</div>
            <p class="results-details" id="resultDetails"></p>
            <div class="results-breakdown">
                <div class="breakdown-item"><div class="breakdown-value correct" id="correctCount">0</div><div class="breakdown-label">Correct</div></div>
                <div class="breakdown-item"><div class="breakdown-value incorrect" id="incorrectCount">0</div><div class="breakdown-label">Incorrect</div></div>
            </div>
            <div class="btn-group" id="resultsButtons">
                <button class="btn btn-primary" id="reviewBtn" onclick="showReview()" style="display: none;">üìä Review Answers</button>
                <button class="btn btn-secondary" onclick="restartQuiz()">üîÑ Restart Quiz</button>
            </div>
        </div>
        <div class="review-section" id="reviewSection">
            <div class="review-header">
                <h2>Answer Review</h2>
                <p class="results-details">Click any question to review the full answer and explanation</p>
            </div>
            <p class="review-hint">üí° Tip: Click on any row to see the full question and explanation in Learn mode</p>
            <table class="review-table">
                <thead>
                    <tr>
                        <th style="width: 5%">#</th>
                        <th style="width: 50%">Question</th>
                        <th style="width: 15%">Your Answer</th>
                        <th style="width: 15%">Correct Answer</th>
                        <th style="width: 15%">Status</th>
                    </tr>
                </thead>
                <tbody id="reviewTableBody"></tbody>
            </table>
            <div class="review-status">
                <p class="results-details">Reviewed: <span id="reviewedCount">0</span> / <span id="totalReviewCount">0</span> questions</p>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="backToResults()">‚Üê Back to Results</button>
            </div>
        </div>
    </div>
    <script>
        const questions = [
            {
                id: 1,
                question: "A user has an identity-based policy that allows s3:*, but an SCP denies s3:DeleteObject. A bucket policy also allows s3:* for the user. Can the user delete objects from the bucket?",
                options: [
                    "Yes, because the bucket policy's explicit allow overrides the SCP deny for resource-based access",
                    "No, because explicit denies in SCPs take precedence over all other policy types",
                    "Yes, because identity-based and resource-based policies both allow, creating an effective allow",
                    "No, because resource-based policies cannot override identity-based policy denials"
                ],
                correct: 1,
                explanation: "An explicit deny ALWAYS wins, regardless of which policy type contains it. SCPs are evaluated early in the policy evaluation logic, and a deny in an SCP cannot be overridden by any other policy type - identity-based, resource-based, or otherwise.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic.html"
            },
            {
                id: 2,
                question: "An S3 bucket in Account B (222222222222) has this bucket policy allowing s3:GetObject for an IAM role in Account A (111111111111):\n\n```json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [{\n    \"Effect\": \"Allow\",\n    \"Principal\": {\"AWS\": \"arn:aws:iam::111111111111:role/CrossAccountRole\"},\n    \"Action\": \"s3:GetObject\",\n    \"Resource\": \"arn:aws:s3:::account-b-bucket/*\"\n  }]\n}\n```\n\nThe role in Account A has NO identity-based policies attached. Can the role access objects in the bucket?",
                options: [
                    "No, because cross-account access requires BOTH an explicit Allow in the bucket policy AND an explicit Allow in the role's identity-based policy",
                    "No, because the role has an implicit deny from having no identity-based policies, which cannot be overridden by resource policies",
                    "Yes, because resource-based policies can grant cross-account access independently without requiring identity-based policies on the role",
                    "Yes, but only if you also add a trust policy on the role allowing Account B to assume it"
                ],
                correct: 0,
                explanation: "For cross-account access, you need BOTH sides to explicitly Allow:\n\n1. ‚úÖ Resource-based policy (bucket policy) must Allow - this is present\n2. ‚ùå Identity-based policy on the role must Allow - this is MISSING\n\nThe role needs an identity-based policy like:\n```json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [{\n    \"Effect\": \"Allow\",\n    \"Action\": \"s3:GetObject\",\n    \"Resource\": \"arn:aws:s3:::account-b-bucket/*\"\n  }]\n}\n```\n\nWithout this, the role has an implicit deny that blocks access. Resource-based policies CAN grant same-account access independently, but cross-account requires explicit Allow on both sides.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic.html#policy-eval-basics"
            },
            {
                id: 3,
                question: "A DevOps team creates IAM roles for developers. The security team wants to ensure these roles cannot have more permissions than the DevOps team role itself. What should be implemented?",
                options: [
                    "An SCP at the organization level that restricts the DevOps team's iam:CreateRole permissions",
                    "A permissions boundary that the DevOps team must attach to all roles they create",
                    "A trust policy on the DevOps role that limits which roles it can create",
                    "An IAM policy on the DevOps role that denies creating roles with AdministratorAccess"
                ],
                correct: 1,
                explanation: "A Permissions Boundary sets the maximum permissions that identity-based policies can grant. By requiring DevOps to attach a boundary to created roles, you ensure those roles cannot exceed the boundary's permissions, preventing privilege escalation.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_boundaries.html"
            },
            {
                id: 4,
                question: "A bucket policy needs to allow access from any IAM principal in Account 123456789012. Which Principal element should be used?",
                options: [
                    "'Principal': { 'AWS': 'arn:aws:iam::123456789012:root' } to reference the account",
                    "'Principal': { 'AWS': '123456789012' } using the account ID directly",
                    "'Principal': { 'Account': '123456789012' } using the Account key",
                    "Both A and B are valid; they are equivalent ways to specify the account as principal"
                ],
                correct: 3,
                explanation: "The Principal element specifies who can access a resource. Both 'arn:aws:iam::123456789012:root' and '123456789012' are valid ways to specify an AWS account as principal. They are functionally equivalent and allow any authenticated principal from that account.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_principal.html"
            },
            {
                id: 5,
                question: "A company wants their S3 bucket to only be accessible by principals from within their AWS Organization (o-xxxxxxxxxx). Which condition should they use?",
                options: [
                    "'aws:PrincipalAccount': 'o-xxxxxxxxxx' to verify the principal's account is in the organization",
                    "'aws:PrincipalOrgID': 'o-xxxxxxxxxx' to verify the principal belongs to the organization",
                    "'aws:SourceOrgID': 'o-xxxxxxxxxx' to verify the request source organization",
                    "'aws:RequestOrgID': 'o-xxxxxxxxxx' to verify the organization making the request"
                ],
                correct: 1,
                explanation: "aws:PrincipalOrgID checks if the principal making the request belongs to a specific AWS Organization. It's commonly used in resource-based policies to restrict access to only principals within your organization, simplifying cross-account access management.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-principalorgid"
            },
            {
                id: 6,
                question: "An architect wants to use an IAM group as a principal in an S3 bucket policy to grant access to all group members. Is this possible?",
                options: [
                    "Yes, specify the group ARN in the Principal element like other IAM entities",
                    "Yes, but only if the group has fewer than 100 members due to policy size limits",
                    "No, groups cannot be specified as principals; you must list individual users or use roles",
                    "No, but you can specify the group's path instead of ARN as a workaround"
                ],
                correct: 2,
                explanation: "IAM groups CANNOT be referenced as principals in resource-based policies. Groups can only contain IAM users (not roles), cannot be nested, and don't have credentials. For resource policies, you must specify individual users, roles, or entire accounts.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_groups.html"
            },
            {
                id: 7,
                question: "A security team wants to allow all AWS actions EXCEPT IAM actions. Which policy construct should they use?",
                options: [
                    "'Effect': 'Deny' with 'Action': 'iam:*' to block IAM while allowing everything else",
                    "'Effect': 'Allow' with 'NotAction': 'iam:*' to allow everything except IAM actions",
                    "'Effect': 'Allow' with 'Action': '*' and a separate 'NotAction': 'iam:*' statement",
                    "'Effect': 'Deny' with 'NotAction': 'iam:*' to deny everything except IAM actions"
                ],
                correct: 1,
                explanation: "NotAction with Allow matches all actions EXCEPT those specified, effectively allowing everything except IAM. Note that using Deny with NotAction would deny everything except IAM - the opposite of what's wanted.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_notaction.html"
            },
            {
                id: 8,
                question: "A new IAM user is created but no policies are attached. The user tries to list S3 buckets. What happens?",
                options: [
                    "The action succeeds because users have read-only access by default",
                    "The action is denied because of the implicit deny; no permissions are granted by default",
                    "The action succeeds but only returns buckets with public access enabled",
                    "The action prompts for MFA verification before granting read access"
                ],
                correct: 1,
                explanation: "By default, IAM users have NO permissions. This is the implicit deny - unless a policy explicitly allows an action, it's denied. The user must have permissions granted through identity-based policies, group membership, or role assumption.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html"
            },
            {
                id: 9,
                question: "A security team needs to identify S3 buckets that are accessible by principals outside their AWS Organization. Which tool should they use?",
                options: [
                    "Amazon Macie to scan bucket policies for external access patterns",
                    "IAM Access Analyzer to identify resources shared outside the zone of trust",
                    "AWS Config with the s3-bucket-public-read-prohibited rule",
                    "Amazon GuardDuty to detect unauthorized cross-account access attempts"
                ],
                correct: 1,
                explanation: "IAM Access Analyzer identifies resources (S3 buckets, IAM roles, KMS keys, etc.) that are shared with external entities outside your zone of trust (account or organization). It continuously monitors and generates findings for resources with external access.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/what-is-access-analyzer.html"
            },
            {
                id: 10,
                question: "A company wants to restrict IAM operations to only be allowed from their corporate IP range. Which condition key should be used?",
                options: [
                    "'aws:SourceArn' with the corporate network identifier as the ARN",
                    "'aws:SourceIp' with the corporate CIDR range, but note it won't work for service calls",
                    "'aws:VpcSourceIp' with the corporate VPC CIDR range for internal network restriction",
                    "'aws:CallerIdentity' with IP address validation in the condition"
                ],
                correct: 1,
                explanation: "aws:SourceIp restricts API calls based on source IP address or CIDR range. Important caveat: this condition doesn't work for calls made through AWS services on your behalf (like CloudFormation creating resources), as those originate from AWS IPs.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-sourceip"
            },
            {
                id: 11,
                question: "A policy needs to ensure that EC2 instances can only be launched if they have an 'Environment' tag with value 'Production' or 'Staging'. Which condition key should be used?",
                options: [
                    "'aws:ResourceTag/Environment' to check the Environment tag value on the instance",
                    "'aws:RequestTag/Environment' to validate the tag during the RunInstances call",
                    "'ec2:TagKeys' to ensure the Environment key is present in the request",
                    "'ec2:ResourceTag/Environment' with StringEquals for the allowed values"
                ],
                correct: 1,
                explanation: "aws:RequestTag controls tags being APPLIED during resource creation. It validates tags in the RunInstances request. Use aws:ResourceTag to check EXISTING tags on resources. For creation-time enforcement, RequestTag is appropriate.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/access_tags.html"
            },
            {
                id: 12,
                question: "A delegated admin can create IAM roles for their team. How can you prevent them from creating a role with AdministratorAccess?",
                options: [
                    "Use an SCP to deny iam:CreateRole for roles with AdministratorAccess attached",
                    "Require them to attach a permissions boundary to any role they create, limiting maximum permissions",
                    "Remove iam:AttachRolePolicy from their permissions so they can only create roles, not attach policies",
                    "Create a Config rule that deletes roles with AdministratorAccess as soon as they're created"
                ],
                correct: 1,
                explanation: "Permissions boundaries prevent privilege escalation by setting maximum permissions for created roles. Even if someone can create roles and attach policies, the boundary limits effective permissions. You can require boundary attachment via IAM policy conditions.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_boundaries.html"
            },
            {
                id: 13,
                question: "A developer can create EC2 instances but receives 'not authorized to perform iam:PassRole' when trying to launch an instance with an IAM role. What's missing?",
                options: [
                    "The developer needs sts:AssumeRole permission to use the role with EC2",
                    "The developer needs iam:PassRole permission to pass the role to the EC2 service",
                    "The EC2 service needs to be added to the role's trust policy as a principal",
                    "The developer needs iam:CreateServiceLinkedRole to link the role to EC2"
                ],
                correct: 1,
                explanation: "iam:PassRole controls who can pass an IAM role to an AWS service. The developer needs explicit iam:PassRole permission (typically scoped to specific role ARNs) to configure EC2 instances with IAM roles. This is a common delegation control.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_passrole.html"
            },
            {
                id: 14,
                question: "A Lambda function in Account A needs to access a DynamoDB table in Account B. Which approach is MOST straightforward?",
                options: [
                    "Create an SCP in the Organization that allows cross-account DynamoDB access between the accounts",
                    "Add a resource-based policy to the DynamoDB table allowing the Lambda role from Account A",
                    "Create a role in Account B that Account A's Lambda can assume, with permissions to the DynamoDB table",
                    "Configure VPC peering between accounts and use VPC endpoint policies for cross-account access"
                ],
                correct: 2,
                explanation: "DynamoDB doesn't support resource-based policies. For cross-account access, the standard approach is creating a role in Account B with DynamoDB permissions, then configuring the Lambda to assume that role. This works for services without resource policies.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies-cross-account-resource-access.html"
            },
            {
                id: 15,
                question: "A security architect is designing policies for a complex application. What is the maximum size for an IAM managed policy?",
                options: [
                    "2,048 characters, matching the inline policy limit for efficiency",
                    "5,120 characters, the same limit as Service Control Policies",
                    "6,144 characters (approximately 6 KB) including all whitespace",
                    "10,240 characters, doubled from inline policies for managed use cases"
                ],
                correct: 2,
                explanation: "IAM managed policies have a maximum size of 6,144 characters (approximately 6 KB). This includes all whitespace. Inline policies have a smaller limit (2,048). SCPs have 5,120. If you exceed limits, split into multiple policies or optimize the policy structure.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_iam-quotas.html"
            },
            {
                id: 16,
                question: "A policy denies actions unless 'aws:MultiFactorAuthPresent' is true. An IAM user authenticates with MFA and gets console access, then generates access keys from the console. Can they make API calls with those keys?",
                options: [
                    "Yes, because MFA was used to access the console where the keys were created",
                    "No, because long-term access keys don't have aws:MultiFactorAuthPresent in requests",
                    "Yes, but only within the same session that was used to create the keys",
                    "No, because access keys cannot be created when MFA policies are in effect"
                ],
                correct: 1,
                explanation: "aws:MultiFactorAuthPresent checks the CURRENT request's authentication. Long-term access keys don't carry MFA context - the condition key is NOT PRESENT (not false, but missing). The user would need to use GetSessionToken with MFA to get temporary credentials that satisfy this condition.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html"
            },
            {
                id: 17,
                question: "A bucket policy specifies 'Principal': { 'AWS': 'arn:aws:iam::123456789012:group/Developers' }. What is the effect?",
                options: [
                    "All members of the Developers group can access the bucket as intended",
                    "The policy is invalid because groups cannot be principals; it will cause access denied errors",
                    "Only the group creator can access the bucket, not the group members",
                    "The policy grants access to a role named 'group/Developers' if one exists"
                ],
                correct: 1,
                explanation: "IAM groups CANNOT be specified as principals in policies. Group ARNs in Principal elements are invalid. You must specify individual users, roles, or account roots. Policies with invalid principals may cause unexpected access denied errors.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_principal.html"
            },
            {
                id: 18,
                question: "A security team wants to create a least-privilege policy for a production Lambda function that has been running for 90 days. Which tool can help?",
                options: [
                    "IAM Policy Simulator to test what permissions the Lambda currently uses",
                    "IAM Access Analyzer policy generation to analyze CloudTrail and create a policy based on actual usage",
                    "AWS Trusted Advisor to recommend permission reductions based on best practices",
                    "CloudWatch Logs Insights to query Lambda execution logs for API calls made"
                ],
                correct: 1,
                explanation: "IAM Access Analyzer policy generation analyzes CloudTrail logs to identify actions, resources, and conditions actually used. It then generates a least-privilege policy based on that observed activity, perfect for reducing overly permissive policies.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/access-analyzer-policy-generation.html"
            },
            {
                id: 19,
                question: "A complex IAM policy has multiple statements. How can you make the policy easier to understand when troubleshooting?",
                options: [
                    "Add 'Version' elements to each statement to track policy versions",
                    "Add 'Sid' (Statement ID) elements with descriptive identifiers for each statement",
                    "Add 'Comment' elements to each statement explaining its purpose",
                    "Add 'Description' fields to document what each statement accomplishes"
                ],
                correct: 1,
                explanation: "Sid (Statement ID) is an optional identifier you can add to each policy statement. Use descriptive names like 'AllowS3ReadAccess' or 'DenyUnencryptedUploads'. This helps identify which statement affects access during troubleshooting. Note: Comment and Description aren't valid policy elements.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_sid.html"
            },
            {
                id: 20,
                question: "A company wants to require MFA for API calls to delete S3 objects, but the MFA must have been used within the last 5 minutes. Which condition should they use?",
                options: [
                    "'aws:MultiFactorAuthPresent': 'true' with 'aws:TokenIssueTime' for recency check",
                    "'aws:MultiFactorAuthAge' with NumericLessThan 300 seconds to require recent MFA",
                    "'aws:MultiFactorAuthTimestamp' with DateEquals for current-day validation",
                    "'aws:SessionDuration' with NumericLessThan 300 to limit session length"
                ],
                correct: 1,
                explanation: "aws:MultiFactorAuthAge checks how many seconds have passed since MFA authentication. Using NumericLessThan with 300 requires the MFA to have been used within the last 5 minutes. This is useful for requiring fresh MFA for sensitive operations.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html"
            },
            {
                id: 21,
                question: "AWS creates a role named 'AWSServiceRoleForECS' in your account when you use ECS. You want to modify its permissions. Can you?",
                options: [
                    "Yes, modify the attached policies like any other role you own",
                    "No, service-linked roles have AWS-managed permissions that cannot be modified",
                    "Yes, but only by contacting AWS Support to request permission changes",
                    "No, but you can create a custom role with the same trust policy and different permissions"
                ],
                correct: 1,
                explanation: "Service-linked roles are predefined IAM roles that AWS services create. They include all permissions the service requires and CANNOT be modified. You can view their policies and delete them when no longer needed, but you cannot change their permissions.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/using-service-linked-roles.html"
            },
            {
                id: 22,
                question: "A security policy requires that all S3 API calls must be made over HTTPS. Which bucket policy condition enforces this?",
                options: [
                    "'aws:SecureTransport': 'true' in an Allow statement to permit only HTTPS requests",
                    "'aws:SecureTransport': 'false' in a Deny statement to block HTTP requests",
                    "'s3:x-amz-server-side-encryption': 'aws:kms' to require encrypted connections",
                    "'aws:EncryptionContext': 'true' in a Condition to require transport encryption"
                ],
                correct: 1,
                explanation: "Use 'aws:SecureTransport': 'false' in a DENY statement to block HTTP requests. This denies when SecureTransport is false (HTTP), effectively requiring HTTPS. Using 'true' in Allow doesn't prevent HTTP since explicit denies are needed to block actions.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-securetransport"
            },
            {
                id: 23,
                question: "A role's trust policy allows 'Principal': {'Service': 'lambda.amazonaws.com'}. A Lambda function tries to assume a different role using this role's credentials. Can it?",
                options: [
                    "Yes, because Lambda is trusted by the role's trust policy",
                    "No, the trust policy only allows Lambda service to assume the role, not principals using the role",
                    "Yes, but only if the target role also trusts lambda.amazonaws.com",
                    "No, because Lambda functions cannot call sts:AssumeRole"
                ],
                correct: 1,
                explanation: "A trust policy defines who can ASSUME the role, not what the role can do after assumption. The Lambda service can assume this role to run functions. For the Lambda to assume another role, that OTHER role's trust policy must allow the Lambda's role as principal.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html"
            },
            {
                id: 24,
                question: "An SNS topic receives messages from S3 bucket notifications. How do you ensure the SNS topic only accepts messages from YOUR S3 bucket, not an attacker's?",
                options: [
                    "Use 'aws:PrincipalOrgID' to verify S3 is in your organization",
                    "Use 'aws:SourceArn' or 'aws:SourceAccount' to verify which bucket triggered the notification",
                    "Use 'aws:CalledVia' to verify the call chain includes s3.amazonaws.com",
                    "Use 'aws:PrincipalServiceName' to verify the calling service is S3"
                ],
                correct: 1,
                explanation: "aws:SourceArn and aws:SourceAccount prevent the confused deputy problem by verifying WHICH specific resource triggered the service-to-service call. This ensures SNS only accepts notifications from your bucket ARN, not an attacker's bucket configured to notify your topic.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/confused-deputy.html"
            },
            {
                id: 25,
                question: "An IAM role has 10 managed policies attached. The team needs to add another set of permissions. What are their options?",
                options: [
                    "Request a service limit increase to attach more than 10 managed policies",
                    "Consolidate existing policies to make room, or add an inline policy which has a separate limit",
                    "Create a second role with the additional permissions and switch between roles as needed",
                    "All of the above are valid options for adding more permissions to the role"
                ],
                correct: 3,
                explanation: "The default limit is 10 managed policies per role. Options include: requesting a quota increase, consolidating existing policies, using inline policies (separate limit), or creating additional roles. All approaches are valid depending on your use case.",
                docLink: "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_iam-quotas.html"
            }
        ];

        let currentMode = 'learn', currentQuestion = 0, userAnswers = [], answersRevealed = [], shuffledQuestions = [], timerInterval = null, timeRemaining = 0, inReviewMode = false, reviewedQuestions = [];
        function shuffleArray(array) { const a = [...array]; for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }
        function shuffleQuestionOptions(q) { const idx = shuffleArray([0,1,2,3]); return { ...q, options: idx.map(i => q.options[i]), correct: idx.indexOf(q.correct), shuffleMap: idx }; }
        function startQuiz(mode) { currentMode = mode; currentQuestion = 0; userAnswers = new Array(questions.length).fill(null); answersRevealed = new Array(questions.length).fill(false); shuffledQuestions = shuffleArray(questions).map(shuffleQuestionOptions); inReviewMode = false; reviewedQuestions = []; document.getElementById('modeSelector').classList.add('hidden'); document.getElementById('quizContent').classList.remove('hidden'); document.getElementById('resultsCard').classList.remove('show'); document.getElementById('reviewSection').classList.remove('show'); document.getElementById('backToReviewBtn').style.display = 'none'; document.getElementById('totalQ').textContent = shuffledQuestions.length; if (mode === 'exam') { timeRemaining = shuffledQuestions.length * 150; startTimer(); document.getElementById('shuffleBtn').classList.add('hidden'); } else { document.getElementById('timer').textContent = 'Learn Mode'; document.getElementById('shuffleBtn').classList.remove('hidden'); } renderQuestion(); }
        function startTimer() { updateTimerDisplay(); timerInterval = setInterval(() => { timeRemaining--; updateTimerDisplay(); if (timeRemaining <= 0) { clearInterval(timerInterval); showResults(); } }, 1000); }
        function updateTimerDisplay() { const m = Math.floor(timeRemaining / 60), s = timeRemaining % 60, el = document.getElementById('timer'); el.textContent = `${m}:${s.toString().padStart(2, '0')}`; el.classList.remove('warning', 'danger'); if (timeRemaining <= 60) el.classList.add('danger'); else if (timeRemaining <= 300) el.classList.add('warning'); }
        function renderQuestion() { const q = shuffledQuestions[currentQuestion], container = document.getElementById('questionsContainer'), letters = ['A','B','C','D'], ans = userAnswers[currentQuestion], revealed = answersRevealed[currentQuestion]; let opts = q.options.map((o, i) => { let c = 'option'; if (currentMode === 'learn' && revealed) { c += ' disabled'; if (i === q.correct) c += ' correct'; else if (i === ans && ans !== q.correct) c += ' incorrect'; } else if (ans === i) c += ' selected'; return `<div class="${c}" onclick="selectOption(${i})"><span class="option-marker">${letters[i]}</span><span class="option-text">${o}</span></div>`; }).join(''); let exp = currentMode === 'learn' ? `<div class="explanation ${revealed ? 'show' : ''}"><div class="explanation-title">üìñ Explanation</div><div class="answer-header">Correct Answer: ${letters[q.correct]}</div><p class="explanation-text">${q.explanation}</p><a href="${q.docLink}" target="_blank" class="doc-link">üìÑ View AWS Documentation ‚Üí</a></div>` : ''; container.innerHTML = `<div class="question-card"><div class="question-header"><span class="question-number">Question ${currentQuestion + 1}</span><span class="question-domain">IAM Policies</span></div><p class="question-text">${q.question}</p><div class="options">${opts}</div>${currentMode === 'learn' && !revealed ? '<button class="btn btn-primary" style="margin-top:1rem;width:100%;" onclick="revealAnswer()">Show Answer</button>' : ''}${exp}</div>`; document.getElementById('currentQ').textContent = currentQuestion + 1; document.getElementById('progressFill').style.width = `${((currentQuestion + 1) / shuffledQuestions.length) * 100}%`; document.getElementById('prevBtn').disabled = currentQuestion === 0; document.getElementById('nextBtn').textContent = currentQuestion === shuffledQuestions.length - 1 ? (currentMode === 'exam' ? 'Submit Quiz' : 'See Results') : 'Next ‚Üí'; }
        function selectOption(i) { if (currentMode === 'learn' && answersRevealed[currentQuestion]) return; userAnswers[currentQuestion] = i; renderQuestion(); }
        function revealAnswer() { if (userAnswers[currentQuestion] === null) userAnswers[currentQuestion] = -1; answersRevealed[currentQuestion] = true; renderQuestion(); }
        function navigate(d) { if (d === 1 && currentQuestion === shuffledQuestions.length - 1) { showResults(); return; } currentQuestion = Math.max(0, Math.min(currentQuestion + d, shuffledQuestions.length - 1)); renderQuestion(); }
        function shuffleQuiz() { if (currentMode !== 'learn') return; currentQuestion = 0; userAnswers = new Array(questions.length).fill(null); answersRevealed = new Array(questions.length).fill(false); shuffledQuestions = shuffleArray(questions).map(shuffleQuestionOptions); renderQuestion(); }
        function showResults() { if (timerInterval) clearInterval(timerInterval); let correct = shuffledQuestions.reduce((c, q, i) => c + (userAnswers[i] === q.correct ? 1 : 0), 0); const total = shuffledQuestions.length, pct = Math.round((correct / total) * 100), pass = pct >= 80; document.getElementById('quizContent').classList.add('hidden'); document.getElementById('reviewSection').classList.remove('show'); document.getElementById('resultsCard').classList.add('show'); document.getElementById('scorePercent').textContent = pct + '%'; document.getElementById('scorePercent').className = 'results-score ' + (pass ? 'pass' : 'fail'); document.getElementById('resultStatus').textContent = pass ? 'üéâ PASSED!' : 'üìö Keep Studying'; document.getElementById('resultStatus').className = 'results-status ' + (pass ? 'pass' : 'fail'); document.getElementById('resultDetails').textContent = `You answered ${correct} out of ${total} questions correctly.`; document.getElementById('correctCount').textContent = correct; document.getElementById('incorrectCount').textContent = total - correct; if (currentMode === 'exam') document.getElementById('reviewBtn').style.display = 'inline-block'; else document.getElementById('reviewBtn').style.display = 'none'; }
        function restartQuiz() { document.getElementById('resultsCard').classList.remove('show'); document.getElementById('reviewSection').classList.remove('show'); document.getElementById('backToReviewBtn').style.display = 'none'; document.getElementById('modeSelector').classList.remove('hidden'); document.getElementById('quizContent').classList.add('hidden'); inReviewMode = false; reviewedQuestions = []; if (timerInterval) clearInterval(timerInterval); }
        function showReview() { const letters = ['A','B','C','D'], tbody = document.getElementById('reviewTableBody'); tbody.innerHTML = ''; shuffledQuestions.forEach((q, idx) => { const userAns = userAnswers[idx] !== null && userAnswers[idx] !== undefined ? userAnswers[idx] : -1, isCorrect = userAns === q.correct, rowClass = reviewedQuestions.includes(idx) ? 'reviewed' : ''; let row = '<tr class="' + rowClass + '" onclick="reviewQuestion(' + idx + ')">'; row += '<td class="review-q-num">' + (idx + 1) + '</td>'; row += '<td class="review-q-text">' + q.question.substring(0, 100) + (q.question.length > 100 ? '...' : '') + '</td>'; row += '<td class="review-answer ' + (userAns >= 0 ? (isCorrect ? 'correct' : 'incorrect') : '') + '">' + (userAns >= 0 ? letters[userAns] : '‚Äî') + '</td>'; row += '<td class="review-answer correct">' + letters[q.correct] + '</td>'; row += '<td>' + (isCorrect ? '<span style="color:var(--success)">‚úì Correct</span>' : '<span style="color:var(--error)">‚úó Incorrect</span>') + '</td>'; row += '</tr>'; tbody.innerHTML += row; }); document.getElementById('totalReviewCount').textContent = shuffledQuestions.length; document.getElementById('reviewedCount').textContent = reviewedQuestions.length; document.getElementById('resultsCard').classList.remove('show'); document.getElementById('reviewSection').classList.add('show'); }
        function reviewQuestion(qIndex) { if (!reviewedQuestions.includes(qIndex)) { reviewedQuestions.push(qIndex); document.getElementById('reviewedCount').textContent = reviewedQuestions.length; } currentMode = 'learn'; currentQuestion = qIndex; answersRevealed[qIndex] = true; inReviewMode = true; document.getElementById('reviewSection').classList.remove('show'); document.getElementById('quizContent').classList.remove('hidden'); document.getElementById('timer').textContent = 'Learn Mode'; document.getElementById('shuffleBtn').style.display = 'none'; document.getElementById('backToReviewBtn').style.display = 'inline-block'; if (timerInterval) clearInterval(timerInterval); renderQuestion(); }
        function backToReview() { document.getElementById('quizContent').classList.add('hidden'); document.getElementById('backToReviewBtn').style.display = 'none'; document.getElementById('reviewSection').classList.add('show'); showReview(); }
        function backToResults() { document.getElementById('reviewSection').classList.remove('show'); document.getElementById('resultsCard').classList.add('show'); }
    </script>
</body>
</html>
